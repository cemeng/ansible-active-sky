---
- hosts: ninkynonk
  vars:
    http_port: 80
    max_clients: 200
    ruby_version: 2.1.1
    project: active_sky
  remote_user: user
  sudo: true
  tasks:
  - name: Create active_sky user
    # Use python passlib
    action: user name=active_sky update_password=always password=$6$rounds=100000$X0dLo4kO5Wur4Kfv$7BUHaKBeW0fs5ElMBwDrVehSkLTHLGwOwb1DNZMU5CxRh8ZxlIXYw7rPFWeO5/fMgAPHIJJjvf2tdyJ5hOq44.
  # Stolen from https://github.com/hatoishi/ansible-dev/blob/master/ruby-install/tasks/main.yml
  - name: Download ruby-install
    get_url:
      url: https://github.com/postmodern/ruby-install/archive/v0.4.1.tar.gz
      dest: /home/{{ansible_ssh_user}}/ruby-install-0.4.1.tar.gz
  - name: Extract ruby-install
    shell: tar -xzvf ruby-install-0.4.1.tar.gz
  - name: Install ruby-install
    sudo: yes
    # command: make install chdir=/home/{{ansible_ssh_user}}/ruby-install-0.4.1 creates=/usr/local/bin/ruby-install
    shell: "cd /home/{{ansible_ssh_user}}/ruby-install-0.4.1; make install"
  - name: Install Ruby {{ruby}}
    sudo: yes
    sudo_user: "{{project}}"
    shell: /usr/local/bin/ruby-install {{ruby}} creates=~/.rubies/{{ruby}}
    when: ruby is defined
